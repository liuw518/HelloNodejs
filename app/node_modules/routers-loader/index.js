var fs = require('fs');
var _ = require('lodash');

module.exports = function (path, app, rootPath) {
    var router_root_path = rootPath ? rootPath : path;
    var file_separator = '/';
    var index_file = 'index.js';
    var stat = fs.lstatSync(path);
    if (stat.isFile()) {
        if (_.endsWith(path, index_file)) {
            app.use(path.substr(router_root_path.length, path.length - router_root_path.length - index_file.length), require('../..' + path.substr(5)));
        } else {
            app.use(path.substr(router_root_path.length, path.length - router_root_path.length - 3), require('../..' + path.substr(5)));
        }
    } else if (stat.isDirectory()) {
        var files = fs.readdirSync(path);
        var self = arguments.callee;
        _.forEach(files, function (file) {
            self(path + file_separator + file, app, router_root_path);
        });
    } else {
        var err = new Error(path + '不是文件或者目录！');
        throw err;
    }
}